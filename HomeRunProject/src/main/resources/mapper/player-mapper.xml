<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.baseball.player.model.dao.PlayerMapper">

	<!-- 나중에 써야지
	<sql id="playerColumn">  
		SELECT
				PLAYER_NO playerNo,
		        GRADE grade,
		        PLAYER_POSITION playerPosition,
		        BACK_NO backNo,
		        PLAYER_STATUS playerStatus,
		        PLAYER_TEAM playerTeam,
		        USER_NAME userName,
			   (FILE_PATH || '/' || CHANGE_NAME) AS imagePath
	</sql>
	<sql id="playerAttachmentColumn" >
		SELECT
			   PLAYER_ATTACHMENT_NO playerAttachmentNo,
			   REF_PNO refPno,
			   ORIGIN_NAME originName,
			   CREATE_DATE createDate
			   TB_PLAYER_ATTACHMENT.STATUS status
	</sql>
	-->


	<insert id="savePlayer" parameterType="player">
	INSERT 
	  INTO 
	        TB_PLAYER
	        (
	        PLAYER_NO,
	        USER_NO,
	        GRADE,
	        PLAYER_POSITION,
	        PLAYER_DATE,
	        PLAYER_INTRO,
	        PLAYER_SALARY
	        ) 
	VALUES
	        (
	        SEQ_PNO.NEXTVAL,
	        #{userNo},
	        #{grade},
	        #{playerPosition},
	        SYSDATE,
	        #{playerIntro},
	        #{playerSalary}
	        )
	</insert>
	
	<insert id="savePlayerFile" parameterType="com.kh.baseball.player.model.vo.PlayerAttachment">
		INSERT
		  INTO
		  	   TB_PLAYER_ATTACHMENT
		  	   (
		  	   PLAYER_ATTACHMENT_NO,
		  	   REF_PNO,
			   ORIGIN_NAME,
			   CHANGE_NAME,
			   FILE_PATH
			   )
		VALUES
				(
				SEQ_PANO.NEXTVAL,
				SEQ_PNO.CURRVAL,
				#{originName},
				#{changeName},
				#{filePath}
				)
	</insert>
	
	<select id="getTotalCount" resultType="_int">
		SELECT
				COUNT(*)
		 FROM	
		 		TB_PLAYER
		WHERE
				PLAYER_STATUS = 'Y'
	</select>
	
	<!-- 가나다순으로 보기 -->
	<select id="findAllPlayerKorean" resultType="player">
		  SELECT
				PLAYER_NO playerNo,
		        GRADE grade,
		        PLAYER_POSITION playerPosition,
		        BACK_NO backNo,
		        PLAYER_STATUS playerStatus,
		        PLAYER_TEAM playerTeam,
		        USER_NAME userName,
			    CHANGE_NAME AS imagePath
		  FROM
		  		TB_PLAYER
		  JOIN
		  		TB_USER USING (USER_NO)	
		  JOIN
		  		TB_PLAYER_ATTACHMENT ON (PLAYER_NO = REF_PNO)
		 WHERE
		 		PLAYER_STATUS = 'Y'
		   AND
		   		GRADE = 1
		 ORDER
		 	BY
		 		USER_NAME ASC
	</select>
	
	
	<select id="findPlayerDetail" resultType="player">
		SELECT
		        PLAYER_NO playerNo,
		        USER_NAME userName,				
				BACK_NO backNo,
				PLAYER_TEAM playerTeam,
				PLAYER_POSITION playerPosition,									
				PLAYER_DATE playerDate,
				PLAYER_INTRO playerIntro,
				PLAYER_SALARY playerSalary,
			    CHANGE_NAME AS imagePath
		  FROM
		  		TB_PLAYER
		  JOIN
		  		TB_USER ON (USER_NO = PLAYER_NO)	
		  JOIN
		  		TB_PLAYER_ATTACHMENT ON (PLAYER_NO = PLAYER_ATTACHMENT_NO)
		 WHERE
		 		PLAYER_STATUS = 'Y'
		   AND
		   		GRADE = 1
		   AND
		   		PLAYER_NO = #{playerNo}
	</select>



</mapper>